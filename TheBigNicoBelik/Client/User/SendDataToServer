package com.dontknow.myapplication231.User;

import android.os.AsyncTask;
import android.util.Log;
import android.view.View;

import org.json.JSONException;
import org.json.JSONObject;

import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.net.Socket;

class SendDataToServer extends AsyncTask<Void,Void,Void> {
    private Socket socket;
    private String name;
    private String password;
    private static final String debug = "debug";
    private static final String info = "INFO";
    protected static String server_IP = "192.168.123.2";
    protected static final int server_Port = 8607;

   SendDataToServer(String name, String password){
       this.name = name;
       this.password = password;


    }

    @Override
    protected void onPreExecute() {
        try {

            Log.i(debug,"Attempt to connect to server");
            socket = new Socket(server_IP,server_Port);
            Log.i(debug,"Connection established");

        }catch (IOException e){
            e.printStackTrace();
        }

        }

    @Override
    protected Void doInBackground(Void... voids) {
        JSONObject user = new JSONObject();
        try {
            user.put("name",name);
            user.put("name",password);

        } catch (JSONException e) {
            e.printStackTrace();
        }
        try{
            BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream()));
            bw.write(String.valueOf(user));
            Log.i(info,"JSON has sent");


            BufferedReader br = new BufferedReader(new InputStreamReader(socket.getInputStream()));
            br.readLine();
            Log.i(info,br.readLine());

        }catch (IOException e) {
            e.printStackTrace();
        }


        return null;
    }

    @Override
    protected void onPostExecute(Void aVoid) {
        try {
            socket.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
